<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>App</title>

</head>

<body>

    <div id="root">
        <form>
            <span>
                Se connecter
            </span>
            <br />
            <input type="text" id="email" name="email" placeholder="Email">
            <span class="focus-input100"></span>
            <br />
            <input type="password" id="pass" name="pass" placeholder="Password">
            <span class="focus-input100"></span>
            <br />
            <input name="bouton_terminer" type="button" value="Terminer"
                   onclick="RedirectionJavascript()">
        </form>
    </div>
    <p></p>
    <div id="connected"></div>
    <div id="bills"></div>

    <script>
        const app = document.getElementById('root')

        function RedirectionJavascript() {
            var request = new XMLHttpRequest()

            var mail = document.getElementById('email').value;
            var pwd = document.getElementById('pass').value;

            request.open('GET', "http://localhost:64228/api/user/" + mail + "/" + pwd, true)
            request.onload = function () {
                // Begin accessing JSON data here
                var data = JSON.parse(this.response);
                console.log("data");
                console.log(data);
                if (!data[0]) {
                    document.querySelector('p').textContent = 'Utilisateur non reconnu';
                } else {
                    if (request.status >= 200 && request.status < 400) {
                        data.forEach(element => {
                            app.remove();
                            document.querySelector('p').textContent = '';
                            document.getElementById('connected').innerHTML = "Bonjour " + data[0].PrenomUser + " " + data[0].NomUser + "<br><br><br>";
                            var userid = element.IdUser
                            var request2 = new XMLHttpRequest()                            
                            if (data[0].Role == true) {
                                request2.open('GET', "http://localhost:64228/api/Bills/", true)
                            } else {
                                request2.open('GET', "http://localhost:64228/api/MyBills/" + userid, true)
                            }
                            request2.onload = function () {
                                // Begin accessing JSON data here
                                var data2 = JSON.parse(this.response);
                                console.log("data2");
                                console.log(data2);

                               /* console.log("TEST");
                                var product = JSON.parse(data2.Bill_Product);
                                console.log(product);*/

                                if (request2.status >= 200 && request.status < 400) {
                                    billsLength = data2.length;
                                    data2.forEach(bills => {

                                         //////////////////////////////////////////// ALEX \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
                                        var currentText = document.getElementById('bills').innerHTML;
                                        document.getElementById('bills').innerHTML = currentText
                                            + "Identifiant de facture : " + bills.id_bill + "<br>"
                                            + "Produit : " + bills.Bill_Product[0].Product.product_name + "<br>"
                                            + "Prix à l'unité : " + bills.Bill_Product[0].Product.product_price + "€" + "<br>"
                                            + "Quantité : " + bills.Bill_Product[0].quantity + "<br>"
                                            + "Prix total : " + bills.bill_amount + "€" + "<br>"
                                            + "Date de création : " + bills.bill_date.slice(0,10) + "<br>"
                                            + "Facture déjà payée : " + (bills.bill_paid ? "Oui" : "Non") + "<br>"
                                            + "<img src='" + bills.Bill_Product[0].Product.product_picture + "'>" + "<br><br><br>"
                                            //+ "<br>" + bills.bill_date_paid;

                                        //document.getElementById('bills').innerHTML = bills.Bill_Product[0].Product.product_name;

                                        /*var head = dom.createElement( 'head' );
                                        var body = dom.createElement( 'body' );

                                        //////////////////////////////////////////// HUGO \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
                                        /*const card = document.createElement('div')
                                        card.setAttribute('class', 'card')
                                        card.text = bills.bill_date;
                                        const h1 = document.createElement('h1');
                                        h1.textContent = bills.bill_date;

                                        
                                        const p = document.createElement('p')
                                        movie.description = movie.description.substring(0, 300)
                                        p.textContent = `${movie.description}...`
                                        /*const container = document.createElement('div')
                                        container.setAttribute('class', 'container')
                                        app.appendChild(container)
                                        container.appendChild(card)
                                        app.bills.appendChild(h1)*/
                                        //card.appendChild(p)
                                        




                                        //////////////////////////////////////////// JQUERY \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
                                        /*var title = "Constructing HTML Elements";

                                        var container = $("<div>");
                                        container.addClass("tutorial");

                                        var h1 = $("<h1>");
                                        h1.text(title);
                                        h1.addClass("tutorial-heading"); 
                                        container.append(h1);

                                        $("body").append(wrapper);*/


                                    })
                                }
                                else {
                                    console.log('error')
                                }
                            };
                            request2.send()
                        })
                    }
                    else {
                        console.log('error')
                    }
                }
            }
            request.send()

        }
    </script>
</body>
</html>


<!--
<head>
    <title>Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

    <div>
        <div>
            <div>
                <form action="http://localhost:64228/api/user/" method="get">
                    <span>
                        Se connecter
                    </span>


                    <div>
                        <input type="text" id="email" name="email" placeholder="Email">
                        <span class="focus-input100"></span>
                    </div>


                    <div>
                        <input type="password" id="pass" name="pass" placeholder="Password">
                        <span class="focus-input100"></span>
                    </div>

                    <div>
                        <button>
                            Login
                        </button>
                    </div>
                    <p></p>
                    <input name="bouton_terminer" type="button" value="Terminer"
                           onclick="RedirectionJavascript()">
                </form>
            </div>
        </div>
    </div>

    <script>
        var currentPage;

        function RedirectionJavascript() {
            var request = new XMLHttpRequest()

            var mail = document.getElementById('email').value;
            var pwd = document.getElementById('pass').value;

            request.open('GET', "http://localhost:64228/api/user/" + mail + "/" + pwd, true)
            request.onload = function () {
                // Begin accessing JSON data here
                var data = JSON.parse(this.response);
                console.log(data[0]);
                if (data[0]) {
                    document.querySelector('p').textContent = 'data received';
                } else {
                    document.querySelector('p').textContent = 'Utilisateur non reconnu';
                }

                console.log(data);

                if (request.status >= 200 && request.status < 400) {
                    data.forEach(element => {
                        console.log(element.IdUser);
                        //document.location.href = "http://localhost:64228/api/Bills/" + element.IdUser;
                    })
                } else {
                    console.log('error')
                }
            }

            request.send()
        }

        /*var request = new XMLHttpRequest();
        //request.responseType = 'text';
        request.onload = function() {
          // Begin accessing JSON data here
          var data = JSON.parse(this.response)

          if (request.status >= 200 && request.status < 400) {
            data.forEach(movie => {
              console.log(movie.NomUser)
            })
          } else {
            console.log('error')
          }
        }
        function RedirectionJavascript() {
            var mail = document.getElementById('email').value;
            var pwd = document.getElementById('pass').value;
            console.log(mail);
            console.log(pwd);
            document.location.href = "http://localhost:64228/api/user/"+ mail + "/" + pwd;
        }*/
    </script>
</body>
-->
